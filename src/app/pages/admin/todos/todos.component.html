<div class="max-w-4xl mx-auto py-10">
  <h2 class="text-2xl font-bold mb-8">Todos</h2>

  <!-- Error -->
  @if (error()) {
  <div class="mb-4 p-3 rounded-md border border-destructive bg-destructive/10 text-destructive text-sm">{{ error() }}
  </div>
  }

  <!-- Add/Edit Todo Form -->
  <div class="mb-8 bg-card border border-border rounded-xl shadow-sm p-6">
    <form [formGroup]="form" (ngSubmit)="editingId() ? updateTodo() : addTodo()" class="flex flex-col gap-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-foreground mb-1">Title</label>
          <input formControlName="title" type="text" placeholder="Title"
            class="w-full px-3 py-2 rounded-md border border-input bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition" />
        </div>
        <div>
          <label class="block text-sm font-medium text-foreground mb-1">Description</label>
          <textarea formControlName="description" placeholder="Description (optional)" rows="1"
            class="w-full px-3 py-2 rounded-md border border-input bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition"></textarea>
        </div>
      </div>
      <div class="flex gap-2 mt-2">
        <button type="submit" [disabled]="form.invalid || loading()"
          class="inline-flex items-center px-5 py-2 rounded-md bg-primary text-primary-foreground font-semibold shadow-sm hover:bg-primary/90 transition disabled:opacity-60 disabled:pointer-events-none">
          {{ editingId() ? 'Update' : 'Add' }} Todo
        </button>
        @if (editingId()) {
        <button type="button" (click)="cancelEdit()"
          class="inline-flex items-center px-5 py-2 rounded-md bg-muted text-foreground font-semibold shadow-sm hover:bg-muted/80 transition">Cancel</button>
        }
      </div>
    </form>
  </div>

  <!-- Todos Table -->
  <div class="bg-card border border-border rounded-xl shadow-sm overflow-x-auto">
    <table class="min-w-full divide-y divide-border">
      <thead class="bg-muted">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider">Title
          </th>
          <th class="px-6 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider">
            Description</th>
          <th class="px-6 py-3 text-center text-xs font-semibold text-muted-foreground uppercase tracking-wider">
            Completed</th>
          <th class="px-6 py-3 text-center text-xs font-semibold text-muted-foreground uppercase tracking-wider">Actions
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-border">
        @for (todo of todos(); track todo.id) {
        <tr class="hover:bg-muted/50 transition">
          <td class="px-6 py-3 align-top">
            <span class="font-medium text-foreground" [class.line-through]="todo.completed">{{ todo.title }}</span>
          </td>
          <td class="px-6 py-3 align-top text-muted-foreground">
            <span [class.line-through]="todo.completed">{{ todo.description }}</span>
          </td>
          <td class="px-6 py-3 align-top text-center">
            <input type="checkbox" [checked]="todo.completed" (change)="toggleComplete(todo)"
              class="accent-primary w-5 h-5 rounded border border-input bg-background focus:ring-2 focus:ring-primary/30 transition" />
          </td>
          <td class="px-6 py-3 align-top text-center">
            <button (click)="editTodo(todo)"
              class="inline-flex items-center p-2 rounded-md hover:bg-primary/10 focus:bg-primary/20 transition"
              title="Edit">
              <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 20h9" />
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M16.5 3.5a2.121 2.121 0 113 3L7 19.5 3 21l1.5-4L16.5 3.5z" />
              </svg>
            </button>
            <button (click)="deleteTodo(todo.id)"
              class="inline-flex items-center p-2 rounded-md hover:bg-destructive/10 focus:bg-destructive/20 transition"
              title="Delete">
              <svg class="w-5 h-5 text-destructive" fill="none" stroke="currentColor" stroke-width="2"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </td>
        </tr>
        } @empty {
        <tr>
          <td colspan="4" class="text-center text-muted-foreground py-10">No todos yet.</td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>