<!-- generic-table.component.html -->
<div class="table-container" [class.loading]="loading">
  <!-- Table Header -->
  <div class="table-header" *ngIf="tableConfig.title || tableConfig.showSearch">
    <h3 *ngIf="tableConfig.title">{{ tableConfig.title }}</h3>
    <div class="search-bar" *ngIf="tableConfig.showSearch">
      <input
        type="text"
        [placeholder]="tableConfig.searchPlaceholder"
        (input)="globalFilter.set($any($event.target).value)"
        [disabled]="loading"
        class="search-input"
      />
    </div>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="error">
    <div class="error-message">{{ error }}</div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="loading-spinner"></div>
    <span>Loading...</span>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && !error && table.getRowModel().rows.length === 0">
    <div class="empty-message">No data available</div>
  </div>

  <!-- Table -->
  <div class="table-wrapper" *ngIf="!loading && !error && table.getRowModel().rows.length > 0">
    <table class="data-table"
           [class.striped]="tableConfig.striped"
           [class.hover]="tableConfig.hover"
           [class.bordered]="tableConfig.bordered">
      <thead>
      <tr *ngFor="let headerGroup of table.getHeaderGroups()">
        <th
          *ngFor="let header of headerGroup.headers"
          [class.sortable]="tableConfig.sortable && header.column.getCanSort()"
          (click)="handleSort(header.column, $event)"
        >
          <div class="header-content">
              <span *ngIf="!header.isPlaceholder">
                {{ header.column.columnDef.header }}
              </span>
            <span class="sort-indicator" *ngIf="tableConfig.sortable && header.column.getCanSort()">
                <span *ngIf="header.column.getIsSorted() === 'asc'">↑</span>
                <span *ngIf="header.column.getIsSorted() === 'desc'">↓</span>
                <span *ngIf="!header.column.getIsSorted()">⇅</span>
              </span>
          </div>
        </th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let row of table.getRowModel().rows"
          class="table-row"
          (click)="onRowClick(row, $event)">
        <td *ngFor="let cell of row.getVisibleCells()">
          <!-- Regular cells -->
          <div *ngIf="cell.column.id !== 'actions'" [innerHTML]="getCellValue(cell)"></div>

          <!-- Action buttons -->
          <div *ngIf="cell.column.id === 'actions'" class="action-buttons" style="display: flex; gap: 4px;">
            <button
              (click)="onActionClick('edit', $any(row.original), $event)"
              style="background: #3b82f6; color: white; padding: 4px 12px; border: none; border-radius: 4px; cursor: pointer;"
              type="button">
              Edit
            </button>
            <button
              (click)="onActionClick('delete', $any(row.original), $event)"
              style="background: #ef4444; color: white; padding: 4px 12px; border: none; border-radius: 4px; cursor: pointer;"
              type="button">
              Delete
            </button>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="tableConfig.showPagination && !loading && !error && table.getRowModel().rows.length > 0">
    <div class="pagination-info">
      <ng-container *ngIf="!isServerSidePagination()">
        Showing {{ table.getState().pagination.pageIndex * table.getState().pagination.pageSize + 1 }}
        to {{ Math.min((table.getState().pagination.pageIndex + 1) * table.getState().pagination.pageSize, table.getFilteredRowModel().rows.length) }}
        of {{ table.getFilteredRowModel().rows.length }} entries
      </ng-container>
      <ng-container *ngIf="isServerSidePagination()">
        Showing {{ (getCurrentPage() - 1) * getEffectivePageSize() + 1 }}
        to {{ Math.min(getCurrentPage() * getEffectivePageSize(), totalCount || 0) }}
        of {{ totalCount || 0 }} entries
      </ng-container>
    </div>
    <div class="pagination-controls">
      <button
        (click)="firstPage()"
        [disabled]="!getCanPreviousPage()"
        class="page-btn"
      >
        ««
      </button>
      <button
        (click)="previousPage()"
        [disabled]="!getCanPreviousPage()"
        class="page-btn"
      >
        ‹
      </button>
      <span class="page-info">
        Page {{ getCurrentPage() }} of {{ getTotalPagesCount() }}
      </span>
      <button
        (click)="nextPage()"
        [disabled]="!getCanNextPage()"
        class="page-btn"
      >
        ›
      </button>
      <button
        (click)="lastPage()"
        [disabled]="!getCanNextPage()"
        class="page-btn"
      >
        »»
      </button>
    </div>
  </div>
</div>
